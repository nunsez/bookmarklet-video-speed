(()=>{var C=Object.defineProperty;var v=n=>{throw TypeError(n)};var k=(n,t,e)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>k(n,typeof t!="symbol"?t+"":t,e),E=(n,t,e)=>t.has(n)||v("Cannot "+e);var T=(n,t,e)=>(E(n,t,"read from private field"),e?e.call(n):t.get(n)),b=(n,t,e)=>t.has(n)?v("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),L=(n,t,e,o)=>(E(n,t,"write to private field"),o?o.call(n,e):t.set(n,e),e),l=(n,t,e)=>(E(n,t,"access private method"),e);var p="nunsez-video-bookmarklet";var S="".concat(p,"-memory"),i="".concat(p,"-controller"),M="".concat(p,"-tickmarks"),x="".concat(p,"-stylesheet"),R="#".concat(i," * {box-sizing: border-box;color: #111;line-height:initial}")+"#".concat(i,", #").concat(i," .range, #").concat(i," .controls {margin: 0;padding: 4px;}")+"#".concat(i,", #").concat(i," .btn {border: 1px solid #444;border-radius: 4px;background-color: #eee;}")+"#".concat(i," {position: fixed;left: 8px;top: 8px;width: 150px;font: 15px monospace;box-shadow: 1px 1px 4px #444;user-select: none;z-index: 999999999;}")+"#".concat(i," .controls {display: flex;justify-content: space-between;align-items: center;}")+"#".concat(i," .btn {width: 20px;height: 20px;margin: 0;padding: 0;}")+"#".concat(i," .value {pointer-events: none;}")+"#".concat(i,' .value::after {content: "%";margin-left: 2px;}')+"#".concat(i," .range {width: 100%;}")+"#".concat(i," .range ~ * {display: none;}");function N(n){if(n.head.querySelector("#".concat(x)))return;let t=n.createElement("style");t.setAttribute("id",x),t.textContent=R,n.head.append(t)}var u,c=class c{constructor(t){r(this,"document");r(this,"speed");r(this,"videos",[]);r(this,"oldController");b(this,u,null);this.document=t,this.speed=c.getSpeed(),this.oldController=t.querySelector("#".concat(i))}static getSpeed(){let t=Number.parseInt(localStorage.getItem(S)||"");return Number.isNaN(t)?100:t}static getVideos(t){let e=[];return t.querySelectorAll("video, iframe").forEach(o=>{var a;if(o instanceof HTMLVideoElement)e.push(o);else if(o instanceof HTMLIFrameElement){let d=(a=c.getIDoc(o))==null?void 0:a.querySelector("video");d&&e.push(d)}}),e}static getIDoc(t){var e;try{return((e=t.contentWindow)==null?void 0:e.document)||t.contentDocument}catch(o){return console.log("iframe document is not reachable: "+t.src),null}}initialize(t){setTimeout(()=>{this.videos=c.getVideos(this.document.body),this.setSpeed(this.speed)},500)}get controller(){return T(this,u)}set controller(t){L(this,u,t)}setSpeed(t){if(Number.isNaN(t))return;t===5?this.speed>5?this.speed=0:this.speed=10:t>300?this.speed=300:t<0?this.speed=0:this.speed=t;let e=this.speed.toString();this.controller.value.textContent=e,this.controller.range.value=e,this.videos.forEach(o=>o.playbackRate=this.speed/100),localStorage.setItem(S,e)}};u=new WeakMap;var m=c,s,H,D,f,y,$,A,B,I,h=class h{constructor(t){b(this,s);r(this,"state");r(this,"el");r(this,"subBtn",document.createElement("button"));r(this,"value",document.createElement("div"));r(this,"addBtn",document.createElement("button"));r(this,"range",document.createElement("input"));this.state=t,this.el=document.createElement("div")}append(t){var e;return(e=t.querySelector(i))==null||e.remove(),l(this,s,D).call(this),l(this,s,H).call(this),t.append(this.el),this}};s=new WeakSet,H=function(){this.range.addEventListener("input",()=>{let t=Number.parseFloat(this.range.value);this.state.setSpeed(t)}),this.subBtn.addEventListener("click",()=>this.state.setSpeed(this.state.speed-5)),this.addBtn.addEventListener("click",()=>this.state.setSpeed(this.state.speed+5))},D=function(){this.el.setAttribute("id",i),this.el.append(l(this,s,f).call(this),l(this,s,B).call(this),l(this,s,I).call(this,h.tickMarks))},f=function(){let t=document.createElement("div");return t.classList.add("controls"),t.append(l(this,s,y).call(this),l(this,s,$).call(this),l(this,s,A).call(this)),t},y=function(){return this.subBtn=document.createElement("button"),this.subBtn.textContent="-",this.subBtn.classList.add("btn","sub"),this.subBtn},$=function(){return this.value=document.createElement("div"),this.value.textContent=this.state.speed.toString(),this.value},A=function(){return this.addBtn=document.createElement("button"),this.addBtn.textContent="+",this.addBtn.classList.add("btn","add"),this.addBtn},B=function(){return this.range=document.createElement("input"),this.range.classList.add("range"),this.range.setAttribute("type","range"),this.range.setAttribute("min","10"),this.range.setAttribute("max","300"),this.range.setAttribute("step","10"),this.range.setAttribute("list",M),this.range.value=this.state.speed.toString(),this.range},I=function(t){let e=document.createElement("datalist");e.setAttribute("id",M);let o=t.map(a=>{let d=document.createElement("option");return d.value=a.toString(),d});return e.append(...o),e},r(h,"tickMarks",[10,50,100,150,200,250,300]);var g=h;function w(n){let t=n.document,e=new m(t);if(e.oldController){e.oldController.remove();let a=m.getVideos(t.body);setTimeout(()=>{a.forEach(d=>d.playbackRate=100/100)},505);return}N(t),new MutationObserver(a=>e.initialize(a)).observe(t.body,{childList:!0}),e.controller=new g(e),e.controller.append(e.document.body)}w(window);})();
/**
 * @file A script to control the speed of html5 video playback in the browser.
 * @author Alexander Mandrikov <mad.nunsez@gmail.com>
 * @version 2.0.1
 * @license AGPLv3
 * @see {@link https://github.com/nunsez/bookmarklet-video-speed GitHub} for further information.
 */
