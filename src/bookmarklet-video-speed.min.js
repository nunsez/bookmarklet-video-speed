/**
 * @file A script to control the speed of html5 video playback in the browser.
 * @author Alexander Mandrikov <mad.nunsez@gmail.com>
 * @version 1.0.0
 * @license Apache-2.0
 * @see {@link https://github.com/nunsez/bookmarklet-video-speed GitHub} for further information.
*/
(()=>{const e="nunsez-video-bookmarklet",t=`${e}-memory`,n=`${e}-controller`,o=`${e}-tickmarks`,a=`${e}-stylesheet`,r=`#${n} * { box-sizing: border-box; }#${n}, #${n} .range, #${n} .controls {margin: 0;padding: 4px;}#${n}, #${n} .btn {border: 1px solid #444;border-radius: 4px;background-color: #eee;}#${n} {position: fixed;left: 8px;top: 8px;width: 150px;font: 15px monospace;color: #111;box-shadow: 1px 1px 4px #444;z-index: 999999999;}#${n} .controls {display: flex;justify-content: space-between;align-items: center;}#${n} .btn {width: 20px;height: 20px;margin: 0;padding: 0;}#${n} .value {pointer-events: none;user-select: none;}#${n} .value::after {content: "%";margin-left: 2px;}#${n} .range {width: 100%;}`,s=(e,n)=>{if("string"==typeof e&&(e=Number.parseFloat(e)),!Number.isNaN(e)){switch(!0){case 5===e:n.speed>5?n.speed=0:n.speed=10;break;case e>300:n.speed=300;break;case e<0:n.speed=0;break;default:n.speed=e}n.value.textContent=n.speed,n.range.value=n.speed,n.videos.forEach((e=>e.playbackRate=n.speed/100)),localStorage.setItem(t,n.speed)}},l=e=>{const t=[];return e.querySelectorAll("video, iframe").forEach((e=>{switch(e.tagName){case"VIDEO":e.playbackRate&&t.push(e);break;case"IFRAME":{const o=(n=e,n.contentWindow.document||n.contentDocument).querySelector("video");o?.playbackRate&&t.push(o);break}}var n})),t.length?t:null};(e=>{const{head:d,body:i}=e,c={speed:localStorage.getItem(t)||100,videos:l(i),oldController:i.querySelector(`#${n}`),value:null,range:null};if(!c.videos)return void alert("Sorry, i can't find any html5 videos :(");if(c.oldController)return c.oldController.remove(),void c.videos.forEach((e=>e.playbackRate=1));if(!d.querySelector(`#${a}`)){const t=e.createElement("style");t.setAttribute("id",a),t.type="text/css",t.textContent=r,d.append(t)}const p=e.createElement("div");p.setAttribute("id",n),p.innerHTML=`<div class="controls"><button class="btn sub">-</button><div class="value"></div><button class="btn add">+</button></div><input type="range" class="range" min="10" max="300" step="10" list="${o}"><datalist id="${o}">`+([10,50,100,150,200,250,300].map((e=>`<option value="${e}"></option>`)).join("\n")+"</datalist>"),i.append(p),c.value=p.querySelector(".value"),c.range=p.querySelector(".range");const u=p.querySelector(".sub"),b=p.querySelector(".add");c.range.addEventListener("input",(()=>s(Number.parseFloat(c.range.value),c))),u.addEventListener("click",(()=>s(c.speed-5,c))),b.addEventListener("click",(()=>s(c.speed+5,c))),s(c.speed,c)})(document)})();
